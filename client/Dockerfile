FROM node:20-alpine

WORKDIR /app

COPY ./package.json ./package-lock.json ./

RUN npm ci

COPY ./ .

ARG MONGODB_URL
ARG NEXTAUTH_SECRET
ARG GOOGLE_CLIENT_ID
ARG GOOGLE_CLIENT_SECRET
ARG ENGLISH_LEMMATIZER_URL
ARG OPENAI_API_KEY

ENV MONGODB_URL=$MONGODB_URL
ENV NEXTAUTH_SECRET=$NEXTAUTH_SECRET
ENV GOOGLE_CLIENT_ID=$GOOGLE_CLIENT_ID
ENV GOOGLE_CLIENT_SECRET=$GOOGLE_CLIENT_SECRET
ENV ENGLISH_LEMMATIZER_URL=$ENGLISH_LEMMATIZER_URL
ENV OPENAI_API_KEY=$OPENAI_API_KEY

RUN npm run build

EXPOSE 3000

CMD ["npm", "start"]
